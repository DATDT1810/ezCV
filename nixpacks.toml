[phases.setup]
cmds = [
    # DEBUG CHI TIẾT
    "echo '=== CURRENT DIRECTORY ==='",
    "pwd",
    "echo '=== LIST ALL FILES AND FOLDERS ==='",
    "ls -la",
    "echo '=== CHECK SRC FOLDER EXISTS ==='",
    "ls -la src/ || echo 'src folder not found'",
    "echo '=== CHECK SRC CONTENTS ==='",
    "ls -la src/ 2>/dev/null || echo 'Cannot list src'",
    "echo '=== FIND ALL CSPROJ FILES IN ENTIRE SYSTEM ==='",
    "find /app -name '*.csproj' -type f 2>/dev/null || find . -name '*.csproj' -type f",
    "echo '=== CHECK EZCV.API SPECIFICALLY ==='",
    "ls -la src/ezCV.Api/ 2>/dev/null || echo 'ezCV.Api folder not found in src'",
    "ls -la ezCV.Api/ 2>/dev/null || echo 'ezCV.Api folder not found in root'",
    
    # Thử restore với các đường dẫn khác nhau
    "echo '=== ATTEMPT RESTORE ==='",
    "dotnet restore src/ezCV.Api/ezCV.Api.csproj || echo 'Restore failed with src/ path'",
    "dotnet restore ezCV.Api/ezCV.Api.csproj || echo 'Restore failed with root path'"
]

[phases.build]
cmds = [
    "echo '=== BUILD PHASE ==='",
    "dotnet build src/ezCV.Api/ezCV.Api.csproj -c Release -o /app/output/api || dotnet build ezCV.Api/ezCV.Api.csproj -c Release -o /app/output/api",
    "dotnet build src/ezCV.Web/ezCV.Web.csproj -c Release -o /app/output/web || dotnet build ezCV.Web/ezCV.Web.csproj -c Release -o /app/output/web"
]

[[services]]
name = "api"
[services.start]
cmd = "dotnet /app/output/api/ezCV.Api.dll --urls=http://0.0.0.0:8081"

[[services]]
name = "web"
[services.start]
cmd = "dotnet /app/output/web/ezCV.Web.dll --urls=http://0.0.0.0:8080"