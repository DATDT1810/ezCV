﻿@{
    ViewData["Title"] = "Home Page";
}

@model IEnumerable<ezCV.Web.Models.CvTemplate.CvTemplateResponse>

<div id="test-popup" class="white-popup mfp-hide">
    <div class="top-form-header">
        <h4>Đăng nhập</h4>
    </div>
    <!-- Thêm anti-forgery token cho bảo mật -->
    <form action="/Auth/ajax-login" id="main_login_form" method="post">
        @Html.AntiForgeryToken()
        <div class="row">
            <!-- Khu vực hiển thị lỗi chung -->
            <div id="login-error-message" class="col-12 text-danger mb-3" style="display:none;"></div>

            <div class="col-12 col-md-12">
                <div class="group">
                    <input type="text" name="email" id="login-email" required="">
                    <span class="highlight"></span>
                    <span class="bar"></span>
                    <label>Email</label>
                    <!-- Thêm span hiển thị lỗi cho email -->
                    <span id="login-email-error" class="text-danger small error-message" style="display:none;"></span>
                </div>
            </div>
            <div class="col-12 col-md-12">
                <div class="group">
                    <input type="password" name="password" id="login-password" required="">
                    <span class="highlight"></span>
                    <span class="bar"></span>
                    <label>Mật khẩu</label>
                    <!-- Thêm span hiển thị lỗi cho password -->
                    <span id="login-password-error" class="text-danger small error-message" style="display:none;"></span>
                </div>
            </div>

            <div class="col-12 col-sm-5 text-left ">
                <button type="submit" class="btn dream-btn">Đăng nhập</button>
            </div>
            <div class="col-12 col-sm-7 text-left">
                <p class="mb-0">Bạn chưa có tài khoản? <a href="#signup-popup" class="open-popup-link">Đăng ký</a></p>
                <p class="mb-0"><a href="#forgot-password-popup" class="open-popup-link">Quên mật khẩu?</a></p>
            </div>
        </div>
    </form>
    <div class="other-accounts text-center">
        <p class="w-text m-0">Login with other account</p>
        <div class="footer-social-info">
            <a asp-controller="Auth" asp-action="LoginWithGoogle"><i class="fa fa-google-plus" aria-hidden="true"></i></a>
        </div>
    </div>
</div>

<!-- signup popup form so: -->
<div id="signup-popup" class="white-popup mfp-hide">
    <div class="top-form-header">
        <h4>Đăng ký</h4>
    </div>
    <form action="/Auth/ajax-register" method="post" id="main_Signup_form">
        @Html.AntiForgeryToken()
        <div class="row">
            <!-- Khu vực hiển thị lỗi chung -->
            <div id="register-error-message" class="col-12 text-danger mb-3" style="display:none;"></div>

            <div class="col-12 col-md-12">
                <div class="group">
                    <input type="text" name="email" id="signup-email" required="">
                    <span class="highlight"></span>
                    <span class="bar"></span>
                    <label>Email</label>
                    <!-- Thêm span hiển thị lỗi cho email đăng ký -->
                    <span id="signup-email-error" class="text-danger small error-message" style="display:none;"></span>
                </div>
            </div>
            <div class="col-12 col-md-12">
                <div class="group">
                    <input type="password" name="password" id="signup-password" required="">
                    <span class="highlight"></span>
                    <span class="bar"></span>
                    <label>Mật khẩu</label>
                    <!-- Thêm span hiển thị lỗi cho password -->
                    <span id="signup-password-error" class="text-danger small error-message" style="display:none;"></span>
                </div>
            </div>
            <div class="col-12 col-md-12">
                <div class="group">
                    <input type="password" name="confirmPassword" id="signup-confirm-password" required="">
                    <span class="highlight"></span>
                    <span class="bar"></span>
                    <label>Nhập lại mật khẩu</label>
                    <!-- Thêm span hiển thị lỗi cho confirm password -->
                    <span id="signup-confirm-password-error" class="text-danger small error-message" style="display:none;"></span>
                </div>
            </div>

            <div class="col-12 col-sm-5 text-left ">
                <button type="submit" class="btn dream-btn">Đăng ký</button>
            </div>
            <div class="col-12 col-sm-7 text-left">
                <p class="mb-0 mt-10">Bạn đã có tài khoản? <a class="open-popup-link" href="#test-popup">Đăng nhập</a></p>
            </div>
        </div>
    </form>
</div>

<!-- Popup Quên mật khẩu -->
<div id="forgot-password-popup" class="white-popup mfp-hide">
    <div class="top-form-header">
        <h4>Quên mật khẩu</h4>
    </div>
    <form id="forgot-password-form" method="post">
        @Html.AntiForgeryToken()
        <div class="row">
            <!-- Khu vực hiển thị thông báo -->
            <div id="forgot-password-message" class="col-12 mb-3" style="display:none;"></div>

            <div class="col-12 col-md-12">
                <div class="group">
                    <input type="email" name="email" id="forgot-password-email" required="">
                    <span class="highlight"></span>
                    <span class="bar"></span>
                    <label>Email đăng ký</label>
                </div>
                <p class="text-muted small mt-2">Chúng tôi sẽ gửi link đặt lại mật khẩu đến email của bạn.</p>
            </div>

            <div class="col-12 col-sm-6 text-left">
                <button type="submit" class="btn dream-btn">Gửi yêu cầu</button>
            </div>
            <div class="col-12 col-sm-6 text-right">
                <p class="mb-0 mt-10"><a href="#test-popup" class="open-popup-link">Quay lại đăng nhập</a></p>
            </div>
        </div>
    </form>
</div>
<!-- Popup Nhập OTP -->
<div id="otp-popup" class="white-popup mfp-hide">
    <div class="top-form-header">
        <h4>Xác thực OTP</h4>
    </div>
    <form id="otp-form" method="post">
        @Html.AntiForgeryToken()
        <div class="row">
            <!-- Khu vực hiển thị thông báo -->
            <div id="otp-message" class="col-12 mb-3" style="display:none;"></div>

            <div class="col-12 col-md-12">
                <div class="group">
                    <input type="text" name="otp" id="otp-code" required="" maxlength="6">
                    <span class="highlight"></span>
                    <span class="bar"></span>
                    <label>Mã OTP</label>
                </div>
                <p class="text-muted small mt-2">Mã OTP đã được gửi đến email của bạn.</p>
            </div>

            <div class="col-12 col-sm-6 text-left">
                <button type="submit" class="btn dream-btn">Xác thực</button>
            </div>
            <div class="col-12 col-sm-6 text-right">
                <p class="mb-0 mt-10"><a href="#" id="resend-otp" style="cursor:pointer;">Gửi lại OTP</a></p>
                <p class="mb-0 mt-10"><a href="#forgot-password-popup" class="open-popup-link">Quay lại</a></p>
            </div>
        </div>
    </form>
</div>

<!-- Popup Nhập Mật Khẩu Mới -->
<div id="new-password-popup" class="white-popup mfp-hide">
    <div class="top-form-header">
        <h4>Đặt lại mật khẩu</h4>
    </div>
    <form id="new-password-form" method="post">
        @Html.AntiForgeryToken()
        <div class="row">
            <!-- Khu vực hiển thị thông báo -->
            <div id="new-password-message" class="col-12 mb-3" style="display:none;"></div>

            <div class="col-12 col-md-12">
                <div class="group">
                    <input type="password" name="newPassword" id="new-password" required="">
                    <span class="highlight"></span>
                    <span class="bar"></span>
                    <label>Mật khẩu mới</label>
                    <span id="new-password-error" class="text-danger small error-message" style="display:none;"></span>
                </div>
            </div>
            <div class="col-12 col-md-12">
                <div class="group">
                    <input type="password" name="confirmNewPassword" id="confirm-new-password" required="">
                    <span class="highlight"></span>
                    <span class="bar"></span>
                    <label>Nhập lại mật khẩu mới</label>
                    <span id="confirm-new-password-error" class="text-danger small error-message" style="display:none;"></span>
                </div>
            </div>

            <div class="col-12 col-sm-6 text-left">
                <button type="submit" class="btn dream-btn">Đặt lại mật khẩu</button>
            </div>
            <div class="col-12 col-sm-6 text-right">
                <p class="mb-0 mt-10"><a href="#otp-popup" class="open-popup-link">Quay lại</a></p>
            </div>
        </div>
    </form>
</div>

<!-- Popup Thành Công -->
<div id="success-popup" class="white-popup mfp-hide">
    <div class="top-form-header text-center">
        <div class="success-icon mb-3">
            <i class="fa fa-check-circle" style="font-size: 48px; color: #28a745;"></i>
        </div>
        <h4 class="text-success">Thành công!</h4>
    </div>
    <div class="row">
        <div class="col-12 text-center">
            <p id="success-message" class="mb-4">Mật khẩu đã được đặt lại thành công!</p>
            <button type="button" class="btn dream-btn green-btn" onclick="closeSuccessPopup()">Đóng</button>
        </div>
    </div>
</div>

<!-- ##### Welcome Area Start ##### -->
<section class="welcome_area demo2 flex align-items-center">

    <div class="container">
        <div class="row align-items-center">
            <!-- Welcome Content -->
            <div class="col-12 col-lg-6 col-md-12">
                <div class="welcome-content v2">
                    <div class="promo-section">
                        <div class="integration-link light">
                            <span class="integration-icon">
                                <img src="~/assets/img/svg/img-dollar.svg" width="24" height="24" alt="">
                            </span>
                            <span class="integration-text">Tạo CV chuyên nghiệp trong tầm tay!</span>
                        </div>
                    </div>
                    <h1 class="wow fadeInUp" data-wow-delay="0.2s">Sự nghiệp thành công bắt đầu từ một CV tốt</h1>
                    <p class="wow fadeInUp" data-wow-delay="0.3s">Trình tạo sơ yếu lý lịch hoàn hảo của chúng tôi giúp bạn loại bỏ mọi rắc rối khi viết CV. Hãy chọn từ nhiều mẫu khác nhau và làm theo các hướng dẫn đơn giản để tạo ra một bản CV hoàn chỉnh, sẵn sàng cho công việc mơ ước</p>
                    <div class="dream-btn-group wow fadeInUp" data-wow-delay="0.4s">
                        <a asp-controller="CvTemplate" asp-action="Index" class="btn dream-btn green-btn mr-3">Tạo CV ngay</a>
                    </div> 
                </div>
            </div>
            <div class="col-12 col-lg-6 col-md-12">
                <div class="banner-box mt-2 mb-2">
                    <img src="~/assets/img/core-img/banner2.png" alt="">
                </div>
            </div>

        </div>
    </div>
</section>
<!-- ##### Welcome Area End ##### -->

<div class="clearfix"></div>

<section class="demo m-1 section-padding-70 ring-bg">
    <div class="container">
        <div class="section-heading text-center">
            <div class="dream-dots justify-content-center">
                <span></span><span></span><span></span><span></span><span></span><span></span><span></span>
            </div>
            <h2 class="bold">Các Mẫu CV Của Chúng Tôi</h2>
            <p></p>
        </div>
        <div class="row">

            @if (Model != null && Model.Any())
            {
                @foreach (var template in Model)
                {
                    <div class="col-lg-4 col-md-6 col-sm-12">
                        <div class="demo-item">
                            @* Ảnh Preview *@
                            <a><img src="@Url.Content(template.PreviewImageUrl ?? "~/assets/img/demos/default-cv.png")" alt="@template.TemplateName" class="img-responsive"></a>
                            <div class="preview-btn-wrapper text-center">
                                @* Nút Xem Mẫu *@
                                <a class='preview-demo' style="cursor:pointer;">Xem mẫu <i class="fa fa-search-plus"></i></a>

                                @* Nút Sử dụng mẫu  *@
                                <a asp-controller="CvTemplate" asp-action="Create" asp-route-templateId="@template.Id" class='preview-demo v2'>
                                    Sử dụng mẫu
                                </a>
                            </div>
                        </div>
                    </div>
                }
            }
            else if (string.IsNullOrEmpty(ViewBag.ErrorMessage)) 
            {
                <div class="col-12 text-center">
                    <p>Hiện chưa có mẫu CV nào.</p>
                </div>
            }

        </div>
    </div>
</section>

<!-- AI Chat Floating Button - Mở trang CreateCv -->
<div id="aiChatFloating" class="ai-chat-floating" onclick="openAIChat()">
    <div class="ai-chat-icon">
        <i class="fas fa-robot"></i>
        <span class="ai-pulse"></span>
    </div>
    <div class="ai-chat-tooltip">
        Trợ lý AI tạo CV
    </div>
</div>

@section Scripts {
    <style>
        /* CSS cho trường bị lỗi */
        .error-field {
            border-color: #dc3545 !important;
            background-color: #fff5f5 !important;
        }

            .error-field + .highlight {
                background-color: #dc3545 !important;
            }

                .error-field + .highlight + .bar:before,
                .error-field + .highlight + .bar:after {
                    background-color: #dc3545 !important;
                }

        .error-message {
            font-size: 0.875em;
            margin-top: 5px;
            display: block;
        }

        /* Style cho icon thành công */
        .success-icon {
            animation: bounceIn 0.6s ease-in-out;
        }

        @@keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }

            50% {
                transform: scale(1.05);
                opacity: 1;
            }

            70% {
                transform: scale(0.9);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* AI Chat Floating Button */
        .ai-chat-floating {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            z-index: 1000;
            transition: all 0.3s ease;
            animation: float 3s ease-in-out infinite;
        }

            .ai-chat-floating:hover {
                transform: scale(1.1);
                box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
            }

        .ai-chat-icon {
            color: white;
            font-size: 24px;
            position: relative;
        }

        .ai-pulse {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 12px;
            height: 12px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .ai-chat-tooltip {
            position: absolute;
            right: 70px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .ai-chat-floating:hover .ai-chat-tooltip {
            opacity: 1;
        }

        /* Animations */
        @@keyframes float {
            0%, 100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        @@keyframes pulse {
            0% {
                transform: scale(0.8);
                opacity: 1;
            }

            70% {
                transform: scale(1.5);
                opacity: 0;
            }

            100% {
                transform: scale(0.8);
                opacity: 0;
            }
        }

        /* Responsive */
        @@media (max-width: 768px) {
            .ai-chat-floating {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
            }

            .ai-chat-icon {
                font-size: 20px;
            }

            .ai-pulse {
                width: 10px;
                height: 10px;
            }
        }
    </style>
    <script src="~/assets/js/auth.js"></script>
    <script>
        function openAIChat() {
            // Kiểm tra xem user đã đăng nhập chưa
            const isAuthenticated = @User.Identity.IsAuthenticated.ToString().ToLower();

            if (isAuthenticated) {
                // Nếu đã đăng nhập, chuyển đến trang CreateCv
                window.location.href = '/AIChat/CreateCv';
            } else {
                // Nếu chưa đăng nhập, hiển thị popup đăng nhập
                $.magnificPopup.open({
                    items: {
                        src: '#test-popup'
                    },
                    type: 'inline',
                    mainClass: 'mfp-fade',
                    removalDelay: 300
                });

                // Thêm event listener sau khi login thành công
                $(document).on('auth:loginSuccess', function () {
                    window.location.href = '/AIChat/CreateCv';
                });
            }
        }

        // Thêm hiệu ứng khi scroll
        document.addEventListener('DOMContentLoaded', function () {
            const floatingBtn = document.getElementById('aiChatFloating');

            window.addEventListener('scroll', function () {
                if (window.scrollY > 300) {
                    floatingBtn.style.opacity = '1';
                    floatingBtn.style.transform = 'translateY(0)';
                } else {
                    floatingBtn.style.opacity = '0.8';
                }
            });
        });
    </script>
}

